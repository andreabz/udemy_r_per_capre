---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per gli episodi 10, 11 e 12 - modificare i dati"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Obiettivo dell'episodio

Imparare a **modificare i dati** usando `data.table`.

Gli obiettivi principali:

- rendere i dati coerenti e leggibili
- esplicitare le trasformazioni
- preparare il dataset per report automatici e analisi future

---

## L’operatore `:=`

In `data.table`, `:=` serve a creare o modificare colonne, sempre nell’argomento `j`:

```
DT[i, j, by]
```

Esempio: convertire in data la colonna `data_campionamento` del dataset `misure`:

```{r}
#| eval: false

misure[, data_campionamento := as.IDate(data_campionamento,
                                        format = "%d/%m/%Y")]
```

- l’argomento `i` viene saltato perché vogliamo modificare tutte le righe
- `as.IDate()` converte testo in data, specificando il formato atteso

## Modifiche multiple

Si possono modificare più colonne contemporaneamente:

```{r}
#| eval: false

misure[, `:=` (
  data_campionamento = as.IDate(data_campionamento, format = "%d/%m/%Y"),
  inizio_analisi = as.IDate(data_inizio_analisi),
  fine_analisi = as.IDate(data_fine_analisi),
  data_inizio_analisi = NULL,
  data_fine_analisi = NULL
  )]
```

- creiamo nuove colonne a partire da colonne esistenti
- convertiamo i valori in date
- cancelliamo colonne originali non più necessarie

## Colonne derivate

Le nuove colonne possono derivare da più colonne:

```{r}
#| eval: false

misure[, tempo_analisi := fine_analisi - inizio_analisi]
```

Questo calcola il tempo di analisi come differenza tra due date.

## Modificare solo alcuni valori

Combinando `i` e `j` è possibile modificare solo i valori che soddisfano una condizione:

```{r}
#| eval: false

misure[valore == "valore mancante", valore := NA]
```

I valori che non soddisfano la condizione rimangono invariati.

## Errori comuni

Durante la modifica dei dati è normale:

- sbagliare il nome di una colonna
- dimenticare parentesi o virgolette
- sovrascrivere qualcosa per errore

Se succede, rieseguire lo script completo senza il comando errato: non si perde nulla.

## Punto chiave

`:=` permette di modificare, creare o cancellare colonne in modo chiaro e ripetibile.
Tutte le trasformazioni rimangono nel codice: i dati originali restano tracciabili e leggibili.

## In sintesi

- `:=` è lo strumento principale per modificare colonne
- le trasformazioni sono sempre contenute nello script
- i dati diventano leggibili e coerenti
- stiamo preparando il dataset per i report automatici

