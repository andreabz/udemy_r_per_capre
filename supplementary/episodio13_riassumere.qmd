---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per l'episodio 13 - riassumere i dati"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Introduzione

Finora abbiamo lavorato su:

- singole righe
- singoli campioni
- singole misure

Ma in un report non riporto tutti i dati, ne riporto un riassunto utile per capire cosa ci dice un dataset.

## Perché riassumere i dati

Un dataset grezzo serve a:

- lavorare
- controllare
- correggere

Un report serve a:

- capire
- confrontare
- decidere

Per questo **riduciamo i dati**, in modo controllato e intenzionale.

## L'idea chiave: gruppi + sintesi

Ogni riassunto ha due componenti:

1. **un criterio di raggruppamento**
2. **una o più statistiche di sintesi**

In `data.table` questo si scrive inserendo

- il criterio di raggruppamento in `by`
- le statistiche di sintesi in `j`

con l'ormai consueta sintassi `DT[i, j, by]`

Facciamo un esempio:

```{r}
#| eval: false

misure[, .(
  campioni = uniqueN(id_campione),
  tempo_mediano = median(tempo_analisi)
), by = .(mese_inizio_analisi)]
```

- il gruppo è definito da `by = .(mese_inizio_analisi)`
- come riassunto calcolo il numero di campioni univoci con `uniqueN(id_campione)` e il tempo di analisi mediano con `median(tempo_analisi)`
- raggruppo le varie sintesi in `j` con `.()`

Il risultato di questa sintesi non è salvato da nessuna parte finché non lo assegno a una variabile, ad esempio:

```{r}
#| eval: false

riassunto <- misure[,
              .(
                campioni = uniqueN(id_campione),
                analisi_mediana = median(tempo_analisi |> as.numeric()),
                analisi_veloce = quantile(tempo_analisi, 0.10),
                analisi_lenta = quantile(tempo_analisi, 0.90)
                ),
              by = .(mese_inizio_analisi, id_metodo)]
```

In questo caso, raggruppo per mese di inizio analisi e metodo, calcolo diversi valori che riassumano l'informazione utile del dataset e poi salvo tutto in `riassunto`, così da poterlo utilizzare in seguito.

## Riassunti e leggibilità

Un buon riassunto:

- ha poche colonne
- ha nomi chiari
- è leggibile anche senza contesto

Se una tabella ha bisogno di essere spiegata riga per riga,
probabilmente è troppo complicata.

## Dal riassunto al grafico

Questo tipo di output è pensato per:

- grafici
- tabelle finali
- confronti temporali

Nei prossimi episodi useremo questi riassunti, non i dati grezzi.

## In sintesi

- un report nasce dai riassunti, non dai dati grezzi
- `by =` definisce i gruppi
- decido come riassumere i dati specificando `.()` in `j`
- poche informazioni chiare valgono più di molte confuse

Cominciamo ad avere buona parte degli ingredienti necessari a un vero report.
