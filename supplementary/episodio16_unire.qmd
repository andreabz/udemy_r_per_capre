---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per l'episodio 16 - unire i dati"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Obiettivo dell'episodio

Unire dati provenienti da **più file**.

Spesso i dati non stanno tutti nello stesso file.  
L'obiettivo è ottenere **una tabella completa e coerente** per il report, non imparare tutte le tecniche possibili di unione.


## Il problema reale

Spesso abbiamo:

- una tabella con **misure o risultati** (`misure`)  
- una tabella con **informazioni descrittive** (`elenco_comuni`)

Da sole:

- i numeri non sono interpretabili  
- le descrizioni non hanno dati associati  

Serve **metterle insieme**.


## La chiave: una colonna in comune

Per unire due tabelle serve:

- una colonna presente in entrambe  
- che rappresenti **la stessa cosa**

Esempi:

- codice del punto di campionamento  
- identificativo del sito  
- codice del campione  

Se questa colonna è sbagliata, l'unione sarà concettualmente errata, anche se il codice "funziona".


## Unire i dati con `merge()`

Nel corso usiamo la funzione di R fornita da `data.table`:

```{r}
#| eval: false

misure_complete <- merge(
  misure,
  elenco_comuni,
  by.x = "punto_campionamento",
  by.y = "codice_punto"
)
```

Risultato:

- tutte le colonne di `misure` e `elenco_comuni`
- solo le righe che hanno corrispondenza
- eventuali dati senza corrispondenza vengono esclusi

Questa operazione produce una tabella coerente, pronta per analisi e grafici.

## I controlli fondamentali

Ogni unione richiede controlli.

### Il numero di righe

```{r}
#| eval: false

nrow(misure)
nrow(elenco_comuni)
nrow(misure_complete)
```

- se aumenta → stai duplicando dati
- se diminuisce → stai perdendo dati
- se è uguale → bene, ma non basta

### Valori mancanti

```{r}
#| eval: false

misure_complete[is.na(nome_comune)]
```

Serve a verificare:

- righe senza corrispondenza
- errori nei codici di collegamento

Spesso problemi nei report nascono proprio da unioni sbagliate.

## Per approfondire

- nella console `browseVignettes("data.table")` → *Joins in `data.table`*.

## Punto chiave

`merge()` permette di unire due dataset con una colonna in comune.
L'unione di dati può comportare la perdita o la duplicazione non voluta di informazioni:
è sempre meglio verificare che il risultato ottenuto sia quello desiderato.

In sintesi

- i dati arrivano spesso da file diversi
- serve una colonna in comune per unirli
- `merge()` è sufficiente per il nostro scopo
- controlli su righe e valori mancanti sono obbligatori
- unire i dati rende l'analisi interpretabile e il report affidabile

Se i dati sono collegati correttamente, il report può finalmente raccontare i risultati, non solo mostrare numeri.
