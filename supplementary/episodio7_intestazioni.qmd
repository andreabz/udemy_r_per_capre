---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per l'episodio 7 - pulire le intestazioni"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Introduzione

In questo episodio facciamo la prima modifica reale ai dati.

- Non tocchiamo i valori.
- Non tocchiamo le date.
- Non facciamo analisi.

Puliamo solo **i nomi delle colonne**.

È un passaggio semplice, ma fondamentale:
nomi puliti rendono tutto il resto più leggibile e meno fragile.

## Perché pulire le intestazioni

I nomi delle colonne arrivano spesso da:

- fogli Excel
- esportazioni automatiche
- sistemi esterni

E contengono:

- spazi
- maiuscole
- caratteri strani
- nomi lunghi e incoerenti

In R questi nomi:
- funzionano
- ma rendono il codice più scomodo da scrivere e leggere

## I nomi delle colonne sono un vettore

I nomi delle colonne si ottengono con:

```{r}
#| eval: false

colnames(misure)
```

Il risultato è un elenco di caratteri: R li chiama vettori.

Questo è importante perché:

- possiamo applicare funzioni
- possiamo trasformarli tutti insieme
- non stiamo toccando i dati, solo le etichette

## Rimuovere gli spazi

Un primo intervento tipico:


```{r}
#| eval: false

colnames(misure) <- gsub(" ", "_", colnames(misure))
```

Qui stiamo dicendo:

- prendi tutti i nomi con `colnames(misure)`
- sostituisci gli spazi con _ `gsub(" ", "_", ...)`
- riassegna il risultato alle colonne. `colnames(misure) <- ...`

**Nota bene:** `<-` è una freccia ed è come dire uguale. Prende tutto quello che è alla sua destra e lo salva in quello che sta alla sua sinistra.

In questo caso prendiamo i nomi delle colonne, facciamo la sostituzione e lo risalviamo all'interno dei nomi delle colonne.

## Togliere gli spazi inutili

A volte ci sono spazi all'inizio o alla fine, in questo caso abbiamo già sostituito tutto come _, ma meglio essere sicuri e fare ancora un po' di esercizio:

```{r}
#| eval: false

colnames(misure) <- trimws(colnames(misure))
```

È una funzione semplice ma molto utile.

## Uniformare le maiuscole

Decidiamo una regola.
In questo corso useremo solo minuscole:

```{r}
#| eval: false

colnames(misure) <- tolower(colnames(misure))
```

Non è obbligatorio: è una scelta di stile ma ci eviterà confusione.

## Mettere tutto insieme

Tutti questi passaggi possono essere concatenati:

```{r}
#| eval: false

colnames(misure) <- colnames(misure) |>
  gsub(" ", "_", x = _) |>
  trimws() |>
  tolower()
```

`|>` è la pipe di R: prende il risultato della funzione alla sua sinistra e lo scarica nel primo argomento della funzione alla sua destra.

Nel caso volessi scaricare il risultato della funzione alla sua sinistra in un argomento diverso dal primo della funzione a destra, utilizzerò il segnaposto `_`.
Qui lo uso con `gsub()` che vuole sapere dove fare la sostituzione come terzo argomento (`x = ...`), anziché come primo.

## Cosa abbiamo fatto davvero

In questo episodio:

- non abbiamo cambiato i dati
- non abbiamo fatto analisi
- non abbiamo introdotto concetti complessi

Abbiamo solo deciso di lavorare con nomi semplici e coerenti.

È una scelta che pagherà più avanti.

## In sintesi

- `colnames()` restituisce un vettore
- i vettori si possono trasformare con funzioni
- pulire i nomi rende il codice più chiaro
- iniziare da qui riduce errori futuri

Questo è il primo passo verso un report stabile.