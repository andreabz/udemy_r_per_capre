---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per l'episodio 7 - pulire le intestazioni"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Obiettivo dell'episodio

In questo episodio effettuiamo la prima modifica ai dati.

Non interveniamo sui valori.  
Non modifichiamo date o numeri.  
Non facciamo analisi.

Puliamo esclusivamente **i nomi delle colonne**.

È un passaggio semplice ma fondamentale: nomi coerenti rendono il codice più leggibile e meno fragile.


## Perché pulire le intestazioni

I nomi delle colonne spesso provengono da:

- fogli Excel  
- esportazioni automatiche  
- sistemi esterni  

Possono contenere:

- spazi  
- maiuscole e minuscole miste  
- caratteri non standard  
- nomi lunghi o incoerenti  

In R questi nomi funzionano, ma rendono il codice meno chiaro e più soggetto a errori.

Stabilire una convenzione fin dall’inizio semplifica tutto il lavoro successivo.


## I nomi delle colonne sono un vettore

I nomi delle colonne si ottengono con:

```{r}
#| eval: false

colnames(misure)
```

Il risultato è un vettore di caratteri.

Questo significa che:

- possiamo applicare funzioni
- possiamo trasformare tutti i nomi in modo uniforme
- non stiamo modificando i dati, ma solo le etichette

## Sostituire gli spazi

Un primo intervento tipico:

```{r}
#| eval: false

colnames(misure) <- gsub(" ", "_", colnames(misure))
```

L’operazione è composta da tre passaggi:

- leggiamo i nomi con `colnames(misure)`
- sostituiamo gli spazi con _ tramite `gsub()`
- riassegniamo il risultato ai nomi delle colonne

L’operatore `<-` assegna alla variabile a sinistra il risultato dell’espressione a destra.

## Rimuovere spazi iniziali o finali

Per eliminare eventuali spazi residui:

```{r}
#| eval: false

colnames(misure) <- trimws(colnames(misure))
```

`trimws()` rimuove spazi all’inizio o alla fine delle stringhe.

## Uniformare le maiuscole

In questo corso adottiamo una convenzione semplice: solo minuscole.

```{r}
#| eval: false

colnames(misure) <- tolower(colnames(misure))
```

Non è obbligatorio, ma riduce ambiguità e differenze accidentali.

## Concatenare le trasformazioni

Le operazioni possono essere combinate usando la pipe:

```{r}
#| eval: false

colnames(misure) <- colnames(misure) |>
  gsub(" ", "_", x = _) |>
  trimws() |>
  tolower()
```

L’operatore `|>` passa il risultato della funzione a sinistra come primo argomento della funzione a destra.
Se la funzione non utilizza il primo argomento, si può indicare esplicitamente il punto di inserimento con il segnaposto `_`.

## Punto chiave dell'episodio

Pulire le intestazioni significa:

- stabilire una convenzione
- applicarla in modo sistematico
- rendere il codice più stabile

Non abbiamo modificato i dati.
Abbiamo reso più solida la struttura su cui lavoreremo.

## In sintesi

- `colnames()` restituisce un vettore
- i vettori possono essere trasformati con funzioni
- spazi e maiuscole vanno uniformati
- intervenire sui nomi riduce errori futuri

È un intervento minimo con effetti strutturali sul resto del lavoro.
