---
title: "R per capre - dal foglio di calcolo al report automatico"
subtitle: "Materiale di supporto per la lezione 10 - `data.table` e filtri"
lang: it
format:
  pdf:
    documentclass: article
    papersize: a4
    margin-left: 2.5cm
    margin-right: 2.5cm
    margin-top: 3cm
    margin-bottom: 3cm
    fontsize: 11pt
    mainfont: Inter
    monofont: JetBrains Mono
    linkcolor: teal
    urlcolor: teal
    toc: false
---

::: {.small}
Repository del corso: <https://github.com/andreabz/udemy_r_per_capre>
:::

## Obiettivo dell'episodio

Imparare a **filtrare righe in modo preciso e controllato** usando `data.table`.

In questo episodio:

- non facciamo ancora analisi,
- non costruiamo grafici,
- non calcoliamo indicatori.

Impariamo a selezionare correttamente i dati su cui lavoreremo dopo.


## Cos'è `data.table`

`data.table` è un'estensione di `data.frame`, progettata per lavorare in modo efficiente con dataset anche molto grandi.

Nel corso la usiamo perché:

- è veloce,
- è compatta,
- rende esplicita la struttura delle operazioni sui dati.

La sintassi può sembrare densa, ma è coerente.


## La struttura fondamentale: `DT[i, j, by]`

La sintassi base è sempre:

```
DT[i, j, by]
```

dove:

- `i` seleziona le righe (filtro)
- `j` seleziona o modifica le colonne
- `by` raggruppa i dati per eseguire operazioni per gruppo

In questo episodio lavoriamo solo su `i`.

## Scrivere un filtro

I filtri si scrivono nell'argomento `i` come condizioni logiche.

Una condizione ha sempre questa forma:

```
dove operatore come
```

dove:

- `colonna` è il nome della variabile
- `operatore` definisce il tipo di confronto
- `valore` è ciò che la condizione deve soddisfare

Esempio: voglio solo le righe in cui il metodo è `"CHEM0543d"`.

```{r}
#| eval: false

misure[id_metodo == "CHEM0543d"]
```

Questo restituisce solo le righe che rispettano la condizione.

## Operatori comuni

Operatori di confronto:

- `==`uguale (rispetta maiuscole/minuscole)
- `!=` diverso
- `<`, `<=`, `>`, `>=` confronto numerico (usare solo con variabili numeriche)

Operatori utili con vettori o stringhe:

- `%in%` verifica se un valore è contenuto in un insieme: `colonna %in% c("A", "B")`
- `%like%` verifica la presenza di una sottostringa (utile per stringhe parziali)

Ogni filtro produce un sottoinsieme del dataset originale.

## Filtri multipli

È possibile combinare condizioni usando:

- `&` (AND logico) → entrambe le condizioni devono essere vere
- `|` (OR logico) → almeno una condizione deve essere vera

Esempio:

```{r}
#| eval: false

misure[id_metodo == "CHEM0543d" & LOQ > 10]
```

Questo seleziona solo le righe che soddisfano entrambe le condizioni.

## Per approfondire

Se vuoi approfondire:

- nella console `browseVignettes("data.table")`, comincia da *Introduction to `data.table`*
- per ricordare la sintassi stampa <https://rstudio.github.io/cheatsheets/datatable.pdf>

Non è materiale obbligatorio.
Serve quando vuoi capire meglio la logica generale dello strumento.

## Punto chiave dell'episodio

Prima di analizzare i dati, devi sapere selezionarli correttamente.

Se il filtro è sbagliato, tutto ciò che segue sarà sbagliato.

`DT[i, j, by]` non è solo una sintassi:
è una struttura mentale per lavorare sui dati in modo ordinato.

## In sintesi

- `DT[i, j, by]` è la struttura fondamentale
- `i` serve a filtrare le righe
- un filtro è una condizione logica
- le condizioni possono essere combinate
- la qualità dell'analisi dipende dalla qualità della selezione iniziale
